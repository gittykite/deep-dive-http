# HTTP 메시지

## 3.1 메시지의 흐름
- HTTP 메시지: HTTP 애플리케이션 간에 주고받은 데이터들의 블록
  - 메시지의 내용과 의미를 설명하는 텍스트 메타 정보로 시작
  - 그 다음에 선택적으로 데이터가 올 수 있음
- 클라이언트, 서버, 프락시 사이를 흐름
- 메시지의 방향(트랜잭션 방향)을 의미하는 용어: '인바운드', '아웃바운드', '업스트림', '다운스트림'

### 3.1.1 인바운드와 아웃바운드
- 인바운드: 메시지가 원 서버로 향하는 것
- 아웃바운드: 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것

### 3.1.2 다운스트림과 업스트림
- 요청 메시지냐 응답 메시지냐에 관계없이 모든 메시지는 다운 스트림으로 흐름
- 메시지의 발송자는 수신자의 업스트림

## 3.2 메시지의 각 부분
- 각 메시지는 클라이언트로부터의 요청이나 서버로부터의 응답 중 하나를 포함
- 메시지는 시작줄, 헤더 블록, 본문 이렇게 세 부분으로 이루어짐
  - 시작줄: 이것이 어떤 메시지인지 서술
  - 헤더 블록: 속성
  - 본문: 데이터를 담고 있음, 아예 없을 수도 있다
- 시작줄과 헤더: 줄 단위로 분리된 아스키 문자열
  - 각 줄은 캐리지 리턴(ASCII 13)과 개행 문자(ASCII 10)로 구성된 두 글자의 줄바꿈 문자열로 끝남
  - 이 줄바꿈 문자열은 CRLF라고 씀 -> 빈줄
  - 견고한 문자열이라면 그냥 개행 문자도 받아들일 수 있어야 함
  - 오래되거나 잘못 만들어진 HTTP 애플리케이션들 중에서는 캐리지 리턴과 개행 문자 모두를 항상 전송하지 않는 것들도 있음
- 엔터티 본문이나 메시지 본문은 단순히 선택적인 데이터 덩어리
  - 시작줄이나 헤더와 달리 텍스트나 이진 데이터를 포함할 수도 있고 그냥 비어있을 수도 있음

### 3.2.1 메시지 문법
- 모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류됨
- 요청 메시지: 서버에 어떤 동작을 요구
- 응답 메시지: 요청의 결과를 클라이언트에게 돌려줌
- 요청과 응답 모두 기본적으로 구조가 같음

- 요청 메시지의 형식
  
  <메서드> <요청 URL> <버전>
  
  <헤더>
  
  
  <엔터티 본문>
  
- 응답 메시지의 형식
  
  <버전> <상태 코드> <사유 구절>
  
  <헤더>
  
  
  <엔터티 본문>

* 각 부분에 대한 설명
- 메서드
  - 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작
  - 'GET', 'HEAD', 'POST'와 같이 한 단어로 되어있음
- 요청 URL
  - 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소
  - 완전한 URL이 아닌 URL의 경로 구성요소라고 해도, 클라이언트가 서버와 직접 대화하고 있고 경로 구성요소가 리소스를 가리키는 절대 경로이기만 하면 대체로 문제 없음
  - 서버는 URL에서 생략된 호스트/포트가 자신을 가리키는 것으로 간주할 것
- 버전
  - HTTP/<메이저>.<마이너>
  - 메이저와 마이너는 모두 정수
- 상태 코드
  - 요청 중에 무엇이 일어났는지 설명하는 세자리의 숫자
  - 각 코드의 첫번째 자릿수는 상태의 일반적인 분류('성공','에러' 등)을 나타냄
- 사유 구절(reason-pharse)
  - 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구
  - 상태 코드 이후부터 줄바꿈 문자열까지가 사유 구절
  - 오로지 사람에게 읽히기 위한 목적으로만 존재
- 헤더들
  - 이름, 콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들.
  - 이 헤더의 목록은 빈 줄(CRLF)로 끝나 헤더 목록의 끝과 엔터티 본문의 시작을 표시
  - HTTP/1.1과 같은 몇몇 버전의 HTTP는 요청이나 응답에 어떤 특정 헤더가 포함되어야만 유효한 것으로 간주됨
- 엔터티 본문
  - 임의의 데이터 블록을 포함함
  - 모든 메시지가 엔터테 본문을 갖는 것은 아니므로, 때때로 메시지는 그냥 CRLF로 끝나게 됨
  - 헤더나 엔터테 본문이 없더라도 HTTP 헤더의 집합은 항상 빈 줄(그냥 CRLF)로 끝나야 함
  - 하지만 빠뜨리는 사람들을 위해 CRLF 없이 끝나는 메시지도 받아들일 수 있어야 함

### 3.2.2 시작줄
- 모든 HTTP 메시지는 시작줄로 시작
  - 요청 메시지의 시작줄: 무엇을 해야하는지
  - 응답 메시지의 시작줄 : 무슨 일이 일어났는지
- 요청줄
  - 요청 메시지는 서버에게 리소스에 대해 무언가를 해달라고 부탁
  - 시작줄에는 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 그 동작에 대한 대상을 지칭하는 요청 URL이 들어있음
  - 또한 요청줄은 클라이언트가 어떤 HTTP 버전으로 말하고 있는지 서버에게 알려주는 HTTP 버전도 포함
  - 이 모든 필드는 공백으로 구분됨
- 응답줄
  - 응답 메시지는 수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려줌
  - 응답 메시지의 시작줄 혹은 응답줄에는 응답 메시지에서 쓰인 HTTP의 버전, 숫자로 된 상태코드, 수행 상태에 대해 설명해주는 텍스트로 된 사유구절이 들어있음
  - 이 모든 필드는 공백으로 구분됨
- 메서드
  - 요청의 시작줄은 메서드로 시작, 서버에게 무엇을 해야 하는지 말해줌
  - HTTP, GET, POST 같은 것을 말함
